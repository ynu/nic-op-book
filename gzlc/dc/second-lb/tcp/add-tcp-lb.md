# 新增tcp负载均衡设置

## 概述
由于数据中心内部服务器都使用私网地址，因此，如果需要将服务器的服务公开，需要对其进行负载均衡设置。数据中心的所有服务的负载均衡都在consul中进行服务注册，由consul-template自动生成配置，无需修改物理负载均衡设备或haproxy配置。

### 工作流程

1. 打开 [Consul KEY/VALUE 控制台](http://consul.ynu.edu.cn/ui/#/ynu0/kv/)，具体操作可参考: [如何使用Consul控制它]()
2. 在`/haproxy-tcp`下新建一个目录，名称为实服务端口号（即最终对外提供服务的端口号），取值范围是40000至50000。
3. 在刚建好的目录下新建一个名为`name`的键，其值为此服务的名称，应为英文字母和数字的组合。
4. 在步骤2中建好的目录下建立一个名为`servers`的目录，用于存放网站真实服务器的地址。
5. 在`servers`下建立键值对，键名可任意取，值为网站提供服务的地址和端口号。
6. 检查consul/nodes中haproxy节点是否出错，并检查服务是否运行正确。