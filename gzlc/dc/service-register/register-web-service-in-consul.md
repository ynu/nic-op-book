# 使用consul注册web服务
本文以一个示例描述如何在consul中注册一个web服务。

## 示例描述
假如我们现在有一个web服务，我们将其命名为“book-web"。此服务由两台服务器提供，地址分别是：`http://10.0.0.1:8080`和`http://10.0.0.2:8080`，域名是 `book.itc.ynu.edu.cn`，并用 **nginx** 来为此web服务提供负载均衡功能。

## 注册服务
首先，我们需要在 **consul** 上注册此web服务。服务配置脚本如下：
```
{
  "services": [
    {
      "id": "book-web-0",
      "name": "book-web",
      "tags": ["nginx","master"],
      "address": "10.0.0.1",
      "port": 8080,
    },
    {
      "id": "book-web-1",
      "name": "book-web",
      "tags": ["slave", "nginx"],
      "address": "10.0.0.1",
      "port": 8080
    }
  ]
}
```

需要注意的是：
- 提供服务的实服务器有几台就需要注册几个服务；
- 若服务需要使用nginx提供负载均衡，则每个服务都必须有一个名为`nginx`的tag；
- 每个服务的`id`不能相同，但提供相同功能的服务的这一组服务的`name`必须相同；
- 为了代码简洁，上述配置没有给出`checks`节的相关配置，实际操作时可自行添加。

## 设置相关kv值
由于注册服务时有些信息无法在脚本中给出，因此，我们还需要使用 **consul** 自带的键值数据库系统添加额外的参数配置。
设置步骤如下：
1. 在键值系统的`/services`目录下新建一个 **名称与注册在consul中的服务相同** 的目录。此示例中，我们的服务的名称为`book-web`，因此，我们将建立一个名为`book-web`的目录；
2. 在新建的目录下，再新建一个用于配置域名的键`domain`，其值设置为想要提供服务的域名。此示例为`book.itc.ynu.edu.cn`。

这样，就完成了一个web服务在 **consul** 中的配置。

## 其他
默认情况下，数据中心的HTTP负载均衡(nginx)服务器会根据服务注册的情况自动生成nginx的配置文件并重启服务。